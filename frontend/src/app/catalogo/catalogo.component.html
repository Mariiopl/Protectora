<div class="catalogo-container">
  <h2>游  Mascotas Adoptadas</h2>

  <button *appHasRole="'administrador'" class="btn add" (click)="nuevaMascota()">
    + A침adir Mascota
  </button>

  <div *ngIf="cargando" class="loading">Cargando mascotas...</div>

  <div class="grid" *ngIf="!cargando && mascotas.length > 0">
    <div class="card" *ngFor="let mascota of mascotas">
      
<img [src]="'http://localhost:8080/api/mascotas/imagenes/' + mascota.foto" />



      <h3>{{ mascota.nombre }}</h3>

      <div class="info-basica">
        <p><strong>Especie:</strong> {{ mascota.especie }}</p>
        <p><strong>Raza:</strong> {{ mascota.raza }}</p>
        <p><strong>Edad:</strong> {{ mascota.edad }} a침os</p>
        <p><strong>Sexo:</strong> {{ mascota.sexo }}</p>
        <p><strong>Tama침o:</strong> {{ mascota.tamano }}</p>
      </div>

      <div *ngIf="mascota.mostrarDetalles" class="detalles">
        <p><strong>Car치cter:</strong> {{ mascota.caracter }}</p>
        <p><strong>Necesidades especiales:</strong> {{ mascota.necesidadesEspeciales || 'Ninguna' }}</p>
        <p><strong>Esterilizado:</strong> {{ mascota.esterilizado ? 'S칤' : 'No' }}</p>
        <p><strong>Vacunado:</strong> {{ mascota.vacunado ? 'S칤' : 'No' }}</p>
        <p><strong>Desparasitado:</strong> {{ mascota.desparasitado ? 'S칤' : 'No' }}</p>
        <p><strong>Estado adopci칩n:</strong> {{ mascota.estadoAdopcion }}</p>
        <p><strong>Ubicaci칩n:</strong> {{ mascota.ubicacion }}</p>
        <p><strong>Fecha ingreso:</strong> {{ mascota.fechaIngreso }}</p>
        <p class="desc"><strong>Historia:</strong> {{ mascota.historia }}</p>
      </div>

      <div class="btn-group">
        <button class="btn info" (click)="toggleDetalles(mascota)">
          {{ mascota.mostrarDetalles ? 'Ver menos' : 'Ver m치s' }}
        </button>

        <button *appHasRole="'administrador'" class="btn edit" (click)="abrirModal(mascota)">
          Editar
        </button>

        <button *appHasRole="'administrador'" class="btn delete" (click)="eliminarMascota(mascota)">
          Eliminar
        </button>
      </div>

    </div>
  </div>

  <div *ngIf="!cargando && mascotas.length === 0">
    <p>No hay mascotas disponibles 游냤游냠</p>
  </div>
</div>




<!-- === 칔NICO MODAL (crear y editar) === -->
<div class="modal-backdrop" *ngIf="mostrarModal" (click)="cerrarModal()">
  <div class="modal" (click)="$event.stopPropagation()">

    <div class="modal-header">
      <h3>{{ mascotaSeleccionada?.idMascota ? 'Editar Mascota' : 'Nueva Mascota' }}</h3>
      <button class="close-btn" (click)="cerrarModal()">&times;</button>
    </div>

    <form class="modal-form">
      <div class="form-grid">

        <label>Nombre</label>
        <input type="text" [(ngModel)]="mascotaSeleccionada.nombre" name="nombre" (keypress)="soloTexto($event)"/>

        <label>Especie</label>
        <input type="text" [(ngModel)]="mascotaSeleccionada.especie" name="especie" (keypress)="soloTexto($event)"/>

        <label>Raza</label>
        <input type="text" [(ngModel)]="mascotaSeleccionada.raza" name="raza" (keypress)="soloTexto($event)"/>

        <label>Edad</label>
        <input type="number" [(ngModel)]="mascotaSeleccionada.edad" name="edad"/>

        <label>Sexo</label>
        <select [(ngModel)]="mascotaSeleccionada.sexo" name="sexo">
          <option value="macho">Macho</option>
          <option value="hembra">Hembra</option>
        </select>

        <label>Tama침o</label>
        <select [(ngModel)]="mascotaSeleccionada.tamano" name="tamano">
          <option value="peque침o">Peque침o</option>
          <option value="mediano">Mediano</option>
          <option value="grande">Grande</option>
        </select>

        <label>Car치cter</label>
        <input type="text" [(ngModel)]="mascotaSeleccionada.caracter" name="caracter" (keypress)="soloTexto($event)"/>

        <label>Necesidades especiales</label>
        <textarea [(ngModel)]="mascotaSeleccionada.necesidadesEspeciales" name="necesidadesEspeciales"></textarea>

        <label>Historia</label>
        <textarea [(ngModel)]="mascotaSeleccionada.historia" name="historia"(keypress)="soloTexto($event)"></textarea>

        <label>Ubicaci칩n</label>
        <input type="text" [(ngModel)]="mascotaSeleccionada.ubicacion" name="ubicacion"(keypress)="soloTexto($event)"/>

        <!-- Solo mostrar al editar -->
        <label *ngIf="mascotaSeleccionada?.idMascota">Fecha de ingreso</label>
        <input *ngIf="mascotaSeleccionada?.idMascota" type="date" [(ngModel)]="mascotaSeleccionada.fechaIngreso" name="fechaIngreso"/>

        <div class="checkbox-group">
          <label><input type="checkbox" [(ngModel)]="mascotaSeleccionada.esterilizado" name="esterilizado"/> Esterilizado</label>
          <label><input type="checkbox" [(ngModel)]="mascotaSeleccionada.vacunado" name="vacunado"/> Vacunado</label>
          <label><input type="checkbox" [(ngModel)]="mascotaSeleccionada.desparasitado" name="desparasitado"/> Desparasitado</label>
        </div>

        <!-- Solo mostrar al editar -->
        <label *ngIf="mascotaSeleccionada?.idMascota">Estado de adopci칩n</label>
        <select *ngIf="mascotaSeleccionada?.idMascota" [(ngModel)]="mascotaSeleccionada.estadoAdopcion" name="estadoAdopcion">
          <option value="adoptable">Adoptable</option>
          <option value="en proceso">En proceso</option>
          <option value="adoptado">Adoptado</option>
        </select>

        <label>Foto</label>
        <input type="file" (change)="subirFoto($event)" />

      </div>

      <div class="modal-buttons">
        <button type="button" class="btn save" (click)="guardarMascota()">Guardar</button>
        <button type="button" class="btn cancel" (click)="cerrarModal()">Cancelar</button>
      </div>

    </form>

  </div>
</div>

